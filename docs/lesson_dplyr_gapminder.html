<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>R for reproducible scientific analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Set Up!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_intro_r_rstudio.html">Orientation to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="lesson_spreadsheets_condensed.html">Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_vectors.html">Vectors &amp; Data Types</a>
    </li>
    <li>
      <a href="lesson_data_frames_ecology.html">Data Frames</a>
    </li>
    <li>
      <a href="lesson_dplyr_ecology.html">Using dplyr</a>
    </li>
    <li>
      <a href="lesson_ggplot_ecology.html">Using ggplot2</a>
    </li>
    <li>
      <a href="lesson_data_import.html">Data Import &amp; Export</a>
    </li>
    <li>
      <a href="lesson_visualization_dos.html">Visualization Do's &amp; Don'ts</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
    <li>
      <a href="lesson_tidyr.html">Using tidyr</a>
    </li>
    <li>
      <a href="lesson_lubridate.html">Times &amp; Dates with lubridate</a>
    </li>
    <li>
      <a href="lesson_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_iteration.html">Iteration</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">R for reproducible scientific analysis</h1>
<h3 class="subtitle">Manipulating data.frames</h3>

</div>


<blockquote>
<h2 id="learning-objectives">Learning objectives</h2>
<ul>
<li>Understand the 6 main data types in R</li>
<li>Be able to use the six major dplyr verbs (<code>filter</code>, <code>select</code>, <code>arrange</code>, <code>mutate</code>, <code>group_by</code>, <code>summarize</code>)</li>
<li>Be able to use and understand the advantages of the <code>magrittr</code> pipe: <code>%&gt;%</code></li>
</ul>
</blockquote>
<div id="installing-and-loading-packages" class="section level2">
<h2>Installing and loading packages</h2>
<p><code>dplyr</code> is not part of “base R”; rather it is a package – a library of functions that an R user wrote. This extensibility is part of the beauty of R. As of December 2016, there are 9,600 such packages in the official Comprehensive R Archive Network, better known as <a href="https://cran.r-project.org/">CRAN</a>.</p>
<p><code>dplyr</code> is one of the most popular packages for R. It is part of a suite of R tools that make up “The Tidyverse”. Its author conveniently bundled these tools together in a super-package called <code>tidyverse</code>. To use the tidyverse tools, you first need to download them to your machine (once) and then load them (each R session you want to use them). You can download a package via the RStudio menu bar Tools -&gt; Install Packages…, or with a line of code:</p>
<pre class="r"><code>install.packages(&#39;tidyverse&#39;)</code></pre>
<p>You only have to download the code once. But whenever you want to <em>use</em> a package, you have to load it in your R session. For that, use the <code>library</code> function:</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<blockquote>
<h4 id="challenge-install-and-load-tidyverse" class="challenge">Challenge – Install and load tidyverse</h4>
<ul>
<li>Install the <code>tidyverse</code> &amp; <code>gapminder</code> packages, either with <code>install.packages('tidyverse', 'gapminder')</code> or via the menu bar: Tools -&gt; Install Packages…<br />
</li>
<li>Load <code>tidyverse</code> with <code>library(tidyverse)</code></li>
<li>Load <code>gapminder</code> with <code>library(gapminder)</code>
<ul>
<li>You will see some warnings about conflicts. That’s okay.</li>
</ul></li>
</ul>
</blockquote>
</div>
<div id="vectors-data-types" class="section level2">
<h2>Vectors &amp; Data Types</h2>
<blockquote>
<p>There are six main types of data in R. We’ve already covered 2–3 of them. Can anyone help me list them?</p>
</blockquote>
<p>A vector is the most common and basic data type in R, and is pretty much the workhorse of R. A vector is composed by a series of values, which can be either numbers or characters. We can assign a series of values to a vector using the <strong><code>c()</code></strong> function. For example we can create a vector of animal weights and assign it to a new object <code>weight_g</code>:</p>
<pre class="r"><code>weight_g &lt;- c(50, 60, 65, 82)
weight_g</code></pre>
<pre><code>## [1] 50 60 65 82</code></pre>
<p>A vector can also contain characters:</p>
<pre class="r"><code>animals &lt;- c(&quot;mouse&quot;, &quot;rat&quot;, &quot;dog&quot;)
animals</code></pre>
<pre><code>## [1] &quot;mouse&quot; &quot;rat&quot;   &quot;dog&quot;</code></pre>
<p>The quotes around “mouse”, “rat”, etc. are essential here. Without the quotes R will assume there are objects called mouse, rat and dog. As these objects don’t exist in R’s memory, there will be an error message.</p>
<p>There are many functions that allow you to inspect the content of a vector. <code>length()</code> tells you how many elements are in a particular vector:</p>
<pre class="r"><code>length(weight_g)</code></pre>
<pre><code>## [1] 4</code></pre>
<pre class="r"><code>length(animals)</code></pre>
<pre><code>## [1] 3</code></pre>
<p>An important feature of a vector, is that all of the elements are the same type of data. The function <code>class()</code> indicates the class (the type of element) of an object:</p>
<pre class="r"><code>class(weight_g)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="r"><code>class(animals)</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>The function <code>str()</code> provides an overview of the structure of an object and its elements. It is a useful function when working with large and complex objects:</p>
<pre class="r"><code>str(weight_g)</code></pre>
<pre><code>##  num [1:4] 50 60 65 82</code></pre>
<pre class="r"><code>str(animals)</code></pre>
<pre><code>##  chr [1:3] &quot;mouse&quot; &quot;rat&quot; &quot;dog&quot;</code></pre>
<p>You can also use the <code>c()</code> function to add other elements to your vector:</p>
<pre class="r"><code>weight_g &lt;- c(weight_g, 90) # add to the end of the vector
weight_g &lt;- c(30, weight_g) # add to the beginning of the vector
weight_g</code></pre>
<pre><code>## [1] 30 50 60 65 82 90</code></pre>
<p>In the first line, we take the original vector <code>weight_g</code>, add the value 90 to the end of it, and save the result back into <code>weight_g</code>. Then we add the value 30 to the beginning, again saving the result back into <code>weight_g</code>.</p>
<p>We can do this over and over again to grow a vector, or assemble a dataset. As we program, this may be useful to add results that we are collecting or calculating.</p>
<p>We just saw 2 of the 6 main atomic vector types (or data types) that R uses: <strong>“character”</strong> and <strong>“numeric”</strong>. These are the basic building blocks that all R objects are built from. The other 4 are:</p>
<ul>
<li><strong>“logical”</strong> for TRUE and FALSE (the boolean data type)</li>
<li><strong>“integer”</strong> for integer numbers (e.g., 2L, the L indicates to R that it’s an integer)</li>
<li><strong>“complex”</strong> to represent complex numbers with real and imaginary parts (e.g., <code>1+4i</code>) and that’s all we’re going to say about them</li>
<li><strong>“raw”</strong> that we won’t discuss further</li>
</ul>
<p>Vectors are one of the many data structures that R uses. Other important ones are lists (<code>list</code>), matrices (<code>matrix</code>), data frames (<code>data.frame</code>), factors (<code>factor</code>) and arrays (<code>array</code>).</p>
<div id="challenge" class="section level4">
<h4>Challenge</h4>
<blockquote>
<p>We’ve seen that atomic vectors can be of type character, numeric, integer, and logical. But what happens if we try to mix these types in a single vector? What will happen in each of these examples? (hint: use class() to check the data type of your objects):</p>
</blockquote>
<pre class="r"><code>num_char &lt;- c(1, 2, 3, &#39;a&#39;)
num_logical &lt;- c(1, 2, 3, TRUE)
char_logical &lt;- c(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, TRUE)
tricky &lt;- c(1, 2, 3, &#39;4&#39;)</code></pre>
<blockquote>
<ul>
<li>Why do you think it happens?</li>
<li>You’ve probably noticed that objects of different types get converted into a single, shared type within a vector. In R, we call converting objects from one class into another class coercion. These conversions happen according to a hierarchy, whereby some types get preferentially coerced into other types. Can you draw a diagram that represents the hierarchy of how these data types are coerced?</li>
</ul>
</blockquote>
</div>
</div>
<div id="factors" class="section level2">
<h2>Factors</h2>
<p>Sometimes if we look at a data set with <code>str()</code> we can see columns consist of integers, character, etc. However, sometimes the columns are of a special class called a <code>factor</code>. Factors are very useful and are actually something that make R particularly well suited to working with data, so we’re going to spend a little time introducing them.</p>
<p><strong>Factors are used to represent categorical data</strong>. Factors can be ordered or unordered, and understanding them is necessary for statistical analysis and for plotting.</p>
<p>Factors are stored as integers, and have labels (text) associated with these unique integers. While factors look (and often behave) like character vectors, they are actually integers under the hood, and you need to be careful when treating them like strings.</p>
<p>Once created, factors can only contain a pre-defined set of values, known as levels. By default, R always sorts levels in alphabetical order. For instance, if you have a factor with 2 levels:</p>
<pre class="r"><code>sex &lt;- factor(c(&quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;))</code></pre>
<p>R will assign 1 to the level “<code>female</code>” and 2 to the level “<code>male</code>” (because <strong>f</strong> comes before <strong>m</strong>, even though the first element in this vector is “<code>male</code>”). You can check this by using the function <code>levels()</code>, and check the number of levels using <code>nlevels()</code>:</p>
<pre class="r"><code>levels(sex)</code></pre>
<pre><code>## [1] &quot;female&quot; &quot;male&quot;</code></pre>
<pre class="r"><code>nlevels(sex)</code></pre>
<pre><code>## [1] 2</code></pre>
<p>Sometimes, the order of the factors does not matter, other times you might want to specify the order because it is meaningful (e.g., “low”, “medium”, “high”), it improves your visualization, or it is required by a particular type of analysis. Here, one way to reorder our levels in the sex vector would be:</p>
<pre class="r"><code>sex # current order</code></pre>
<pre><code>## [1] male   female female male  
## Levels: female male</code></pre>
<pre class="r"><code>#&gt; [1] male   female female male  
#&gt; Levels: female male
sex &lt;- factor(sex, levels = c(&quot;male&quot;, &quot;female&quot;))
sex # after re-ordering</code></pre>
<pre><code>## [1] male   female female male  
## Levels: male female</code></pre>
<pre class="r"><code>#&gt; [1] male   female female male  
#&gt; Levels: male female</code></pre>
<p>In R’s memory, these factors are represented by integers (1, 2, 3), but are more informative than integers because factors are self describing: “<code>female</code>”, “<code>male</code>” is more descriptive than 1, 2. Which one is “<code>male</code>”? You wouldn’t be able to tell just from the integer data. Factors, on the other hand, have this information built in. It is particularly helpful when there are many levels (like the species names in our ecology example dataset <a href="https://mikoontz.github.io/data-carpentry-week/data/species.csv">dataset</a>).</p>
<div id="converting-factors" class="section level3">
<h3>Converting factors</h3>
<p>If you need to convert a factor to a character vector, you use <code>as.character(x)</code>.</p>
<pre class="r"><code>as.character(sex)</code></pre>
<pre><code>## [1] &quot;male&quot;   &quot;female&quot; &quot;female&quot; &quot;male&quot;</code></pre>
<p>Converting factors where the levels appear as numbers (such as concentration levels, or years) to a numeric vector is a little trickier. One method is to convert factors to characters and then numbers. Another method is to use the <code>levels()</code> function. Compare:</p>
<pre class="r"><code>f &lt;- factor(c(1990, 1983, 1977, 1998, 1990))
as.numeric(f)               # wrong! and there is no warning...</code></pre>
<pre><code>## [1] 3 2 1 4 3</code></pre>
<pre class="r"><code>as.numeric(as.character(f)) # works...</code></pre>
<pre><code>## [1] 1990 1983 1977 1998 1990</code></pre>
<pre class="r"><code>as.numeric(levels(f))[f]    # The recommended way.</code></pre>
<pre><code>## [1] 1990 1983 1977 1998 1990</code></pre>
<p>Notice that in the <code>levels()</code> approach, three important steps occur:</p>
<ul>
<li>We obtain all the factor levels using <code>levels(f)</code></li>
<li>We convert these levels to numeric values using <code>as.numeric(levels(f))</code></li>
<li>We then access these numeric values using the underlying integers of the vector <code>f</code> inside the square brackets</li>
</ul>
</div>
<div id="using-stringsasfactorsfalse" class="section level3">
<h3>Using <code>stringsAsFactors=FALSE</code></h3>
<p>By default, when building or importing a data frame, the columns that contain characters (i.e., text) are coerced (=converted) into the factor data type. Depending on what you want to do with the data, you may want to keep these columns as character. To do so, <code>read.csv()</code> and <code>read.table()</code> have an argument called <code>stringsAsFactors</code> which can be set to <code>FALSE</code>.</p>
<blockquote>
<p>In most cases, it’s preferable to set <code>stringsAsFactors = FALSE</code> when importing your data, and converting as a factor only the columns that require this data type.</p>
</blockquote>
<p>Compare the output of <code>str(surveys)</code> when setting <code>stringsAsFactors = TRUE</code> (default) and <code>stringsAsFactors = FALSE</code>:</p>
<p>We are going to use the R function <code>download.file()</code> to download the CSV file that contains the survey data from figshare, and we will use <code>read.csv()</code> to load into memory the content of the CSV file as an object of class data.frame.</p>
<p>To download the data into the <code>data/</code> subdirectory, run the following:</p>
<pre class="r"><code>download.file(&quot;https://ndownloader.figshare.com/files/2292169&quot;,
              &quot;data/combined.csv&quot;)</code></pre>
<p>You are now ready to load the data:</p>
<pre class="r"><code>surveys &lt;- read.csv(&#39;data/combined.csv&#39;)</code></pre>
<p>This statement doesn’t produce any output because, as you might recall, assignments don’t display anything. If we want to check that our data has been loaded, we can print the first 6 lines of this data using <code>head(surveys)</code></p>
<p>Now we can look at how reading in the data in different ways affects the different data types (<code>factor</code> vs. <code>character</code>):</p>
<pre class="r"><code>## Compare the difference between when the data are being read as
## `factor`, and when they are being read as `character`.
surveys &lt;- read.csv(&quot;data/combined.csv&quot;, stringsAsFactors = TRUE)
str(surveys)
surveys &lt;- read.csv(&quot;data/combined.csv&quot;, stringsAsFactors = FALSE)
str(surveys)
## Convert the column &quot;plot_type&quot; into a factor
surveys$plot_type &lt;- factor(surveys$plot_type)</code></pre>
<div id="challenge-1" class="section level4">
<h4>Challenge</h4>
<p>We have seen how data frames are created when using the <code>read.csv()</code>, but they can also be created by hand with the <code>data.frame()</code> function. There are a few mistakes in this hand-crafted data.frame, can you spot and fix them? Don’t hesitate to experiment!</p>
<pre class="r"><code>animal_data &lt;- data.frame(animal=c(&quot;dog&quot;, &quot;cat&quot;, &quot;sea cucumber&quot;, &quot;sea urchin&quot;),
                          feel=c(&quot;furry&quot;, &quot;squishy&quot;, &quot;spiny&quot;),
                          weight=c(45, 8 1.1, 0.8))</code></pre>
<blockquote>
<ul>
<li>Can you predict the class for each of the columns in the following example? Check your guesses using str(country_climate):
<ul>
<li>Are they what you expected? Why? Why not?</li>
<li>What would have been different if we had added stringsAsFactors = FALSE to this call?</li>
<li>What would you need to change to ensure that each column had the accurate data type?</li>
</ul></li>
</ul>
</blockquote>
<pre class="r"><code>country_climate &lt;- data.frame(
       country=c(&quot;Canada&quot;, &quot;Panama&quot;, &quot;South Africa&quot;, &quot;Australia&quot;),
       climate=c(&quot;cold&quot;, &quot;hot&quot;, &quot;temperate&quot;, &quot;hot/temperate&quot;),
       temperature=c(10, 30, 18, &quot;15&quot;),
       northern_hemisphere=c(TRUE, TRUE, FALSE, &quot;FALSE&quot;),
       has_kangaroo=c(FALSE, FALSE, FALSE, 1)
       )</code></pre>
<p>The automatic conversion of data type is sometimes a blessing, sometimes an annoyance. Be aware that it exists, learn the rules, and double check that data you import in R are of the correct type within your data frame. If not, use it to your advantage to detect mistakes that might have been introduced during data entry (a letter in a column that should only contain numbers for instance.).</p>
</div>
</div>
</div>
<div id="data-wrangling-with-dplyr" class="section level2">
<h2>Data Wrangling with <code>dplyr</code></h2>
<p>It is an often bemoaned fact that a data scientist spends much, and often most, of her time wrangling data: getting it organized and clean. In this lesson we will learn an efficient set of tools that can handle the vast majority of most data management tasks.</p>
<p>Enter <code>dplyr</code>, a package for making data manipulation easier. More on <code>dplyr</code> later. <code>dplyr</code> is part of <code>tidyverse</code>, so it is already installed on your machine. You can load it individually, or with the other tidyverse packages like this:</p>
<pre class="r"><code>library(tidyverse)
library(gapminder)</code></pre>
<pre><code>## 
## Attaching package: &#39;gapminder&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     gapminder</code></pre>
<p>Those messages and conflicts are normal. The conflicts are R telling you that there are two packages with functions named “filter” and “lag”. When R gives you red text, it’s not always a bad thing, but it does mean you should pay attention and try to understand what it’s trying to tell you.</p>
<p>Remember that you only have to install each package once (per computer), but you have to load them for each R session in which you want to use them.</p>
<p>You also have to load any data you want to use each time you start a new R session. So, if it’s not already loaded, read in the gapminder data. We’re going to use tidyverse’s <code>read_csv</code> instead of base R’s <code>read.csv</code> here. It has a few nice features; the most obvious is that it makes a special kind of data.frame that only prints the first ten rows instead of all 1704.</p>
<pre class="r"><code># gapminder &lt;- read_csv(&#39;data/gapminder-FiveYearData.csv&#39;)
class(gapminder)</code></pre>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<pre class="r"><code>head(gapminder) # look at first few rows</code></pre>
<pre><code>## # A tibble: 6 x 6
##   country      year      pop continent lifeExp gdpPercap
##   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1 Afghanistan  1952  8425333 Asia         28.8      779.
## 2 Afghanistan  1957  9240934 Asia         30.3      821.
## 3 Afghanistan  1962 10267083 Asia         32.0      853.
## 4 Afghanistan  1967 11537966 Asia         34.0      836.
## 5 Afghanistan  1972 13079460 Asia         36.1      740.
## 6 Afghanistan  1977 14880372 Asia         38.4      786.</code></pre>
<pre class="r"><code>str(gapminder) # look at data structure</code></pre>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 1704 obs. of  6 variables:
##  $ country  : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...
##  $ year     : num  1952 1957 1962 1967 1972 ...
##  $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
##  $ continent: chr  &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; ...
##  $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
##  $ gdpPercap: num  779 821 853 836 740 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   country = col_character(),
##   ..   year = col_double(),
##   ..   pop = col_double(),
##   ..   continent = col_character(),
##   ..   lifeExp = col_double(),
##   ..   gdpPercap = col_double()
##   .. )</code></pre>
<p>You can always convert a data.frame into this special kind of data.frame like this:</p>
<pre class="r"><code>gapminder &lt;- tbl_df(gapminder)</code></pre>
</div>
<div id="what-is-dplyr" class="section level2">
<h2>What is dplyr?</h2>
<p>The package <code>dplyr</code> is a fairly new (2014) package that tries to provide easy tools for the most common data manipulation tasks. It is built to work directly with data frames. The thinking behind it was largely inspired by the package <code>plyr</code> which has been in use for some time but suffered from being slow in some cases.<code>dplyr</code> addresses this by porting much of the computation to C++. An additional feature is the ability to work with data stored directly in an external database. The benefits of doing this are that the data can be managed natively in a relational database, queries can be conducted on that database, and only the results of the query returned.</p>
<p>This addresses a common problem with R in that all operations are conducted in memory and thus the amount of data you can work with is limited by available memory. The database connections essentially remove that limitation in that you can have a database of many 100s GB, conduct queries on it directly and pull back just what you need for analysis in R.</p>
<div id="the-five-tasks-of-dplyr" class="section level3">
<h3>The five tasks of <code>dplyr</code></h3>
<p>There are five actions we often want to apply to a tabular dataset:</p>
<ul>
<li>Filter rows</li>
<li>Filter columns</li>
<li>Arrange rows</li>
<li>Make new columns</li>
<li>Summarize groups</li>
</ul>
<p>We are about to see how to do each of those things using the <code>dplyr</code> package. Everything we’re going to learn to do can also be done using “base R”, but <code>dplyr</code> makes it easier, and the syntax is consistent, and it actually makes the computations faster.</p>
<div id="filter" class="section level4">
<h4><code>filter()</code></h4>
<p>Suppose we want to see just the gapminder data for the USA. First, we need to know how “USA” is written in the dataset: Is it USA or United States or what? We can see all the unique values of a variable with the <code>unique</code> function.</p>
<pre class="r"><code>unique(gapminder$country)</code></pre>
<pre><code>##   [1] &quot;Afghanistan&quot;              &quot;Albania&quot;                 
##   [3] &quot;Algeria&quot;                  &quot;Angola&quot;                  
##   [5] &quot;Argentina&quot;                &quot;Australia&quot;               
##   [7] &quot;Austria&quot;                  &quot;Bahrain&quot;                 
##   [9] &quot;Bangladesh&quot;               &quot;Belgium&quot;                 
##  [11] &quot;Benin&quot;                    &quot;Bolivia&quot;                 
##  [13] &quot;Bosnia and Herzegovina&quot;   &quot;Botswana&quot;                
##  [15] &quot;Brazil&quot;                   &quot;Bulgaria&quot;                
##  [17] &quot;Burkina Faso&quot;             &quot;Burundi&quot;                 
##  [19] &quot;Cambodia&quot;                 &quot;Cameroon&quot;                
##  [21] &quot;Canada&quot;                   &quot;Central African Republic&quot;
##  [23] &quot;Chad&quot;                     &quot;Chile&quot;                   
##  [25] &quot;China&quot;                    &quot;Colombia&quot;                
##  [27] &quot;Comoros&quot;                  &quot;Congo Dem. Rep.&quot;         
##  [29] &quot;Congo Rep.&quot;               &quot;Costa Rica&quot;              
##  [31] &quot;Cote d&#39;Ivoire&quot;            &quot;Croatia&quot;                 
##  [33] &quot;Cuba&quot;                     &quot;Czech Republic&quot;          
##  [35] &quot;Denmark&quot;                  &quot;Djibouti&quot;                
##  [37] &quot;Dominican Republic&quot;       &quot;Ecuador&quot;                 
##  [39] &quot;Egypt&quot;                    &quot;El Salvador&quot;             
##  [41] &quot;Equatorial Guinea&quot;        &quot;Eritrea&quot;                 
##  [43] &quot;Ethiopia&quot;                 &quot;Finland&quot;                 
##  [45] &quot;France&quot;                   &quot;Gabon&quot;                   
##  [47] &quot;Gambia&quot;                   &quot;Germany&quot;                 
##  [49] &quot;Ghana&quot;                    &quot;Greece&quot;                  
##  [51] &quot;Guatemala&quot;                &quot;Guinea&quot;                  
##  [53] &quot;Guinea-Bissau&quot;            &quot;Haiti&quot;                   
##  [55] &quot;Honduras&quot;                 &quot;Hong Kong China&quot;         
##  [57] &quot;Hungary&quot;                  &quot;Iceland&quot;                 
##  [59] &quot;India&quot;                    &quot;Indonesia&quot;               
##  [61] &quot;Iran&quot;                     &quot;Iraq&quot;                    
##  [63] &quot;Ireland&quot;                  &quot;Israel&quot;                  
##  [65] &quot;Italy&quot;                    &quot;Jamaica&quot;                 
##  [67] &quot;Japan&quot;                    &quot;Jordan&quot;                  
##  [69] &quot;Kenya&quot;                    &quot;Korea Dem. Rep.&quot;         
##  [71] &quot;Korea Rep.&quot;               &quot;Kuwait&quot;                  
##  [73] &quot;Lebanon&quot;                  &quot;Lesotho&quot;                 
##  [75] &quot;Liberia&quot;                  &quot;Libya&quot;                   
##  [77] &quot;Madagascar&quot;               &quot;Malawi&quot;                  
##  [79] &quot;Malaysia&quot;                 &quot;Mali&quot;                    
##  [81] &quot;Mauritania&quot;               &quot;Mauritius&quot;               
##  [83] &quot;Mexico&quot;                   &quot;Mongolia&quot;                
##  [85] &quot;Montenegro&quot;               &quot;Morocco&quot;                 
##  [87] &quot;Mozambique&quot;               &quot;Myanmar&quot;                 
##  [89] &quot;Namibia&quot;                  &quot;Nepal&quot;                   
##  [91] &quot;Netherlands&quot;              &quot;New Zealand&quot;             
##  [93] &quot;Nicaragua&quot;                &quot;Niger&quot;                   
##  [95] &quot;Nigeria&quot;                  &quot;Norway&quot;                  
##  [97] &quot;Oman&quot;                     &quot;Pakistan&quot;                
##  [99] &quot;Panama&quot;                   &quot;Paraguay&quot;                
## [101] &quot;Peru&quot;                     &quot;Philippines&quot;             
## [103] &quot;Poland&quot;                   &quot;Portugal&quot;                
## [105] &quot;Puerto Rico&quot;              &quot;Reunion&quot;                 
## [107] &quot;Romania&quot;                  &quot;Rwanda&quot;                  
## [109] &quot;Sao Tome and Principe&quot;    &quot;Saudi Arabia&quot;            
## [111] &quot;Senegal&quot;                  &quot;Serbia&quot;                  
## [113] &quot;Sierra Leone&quot;             &quot;Singapore&quot;               
## [115] &quot;Slovak Republic&quot;          &quot;Slovenia&quot;                
## [117] &quot;Somalia&quot;                  &quot;South Africa&quot;            
## [119] &quot;Spain&quot;                    &quot;Sri Lanka&quot;               
## [121] &quot;Sudan&quot;                    &quot;Swaziland&quot;               
## [123] &quot;Sweden&quot;                   &quot;Switzerland&quot;             
## [125] &quot;Syria&quot;                    &quot;Taiwan&quot;                  
## [127] &quot;Tanzania&quot;                 &quot;Thailand&quot;                
## [129] &quot;Togo&quot;                     &quot;Trinidad and Tobago&quot;     
## [131] &quot;Tunisia&quot;                  &quot;Turkey&quot;                  
## [133] &quot;Uganda&quot;                   &quot;United Kingdom&quot;          
## [135] &quot;United States&quot;            &quot;Uruguay&quot;                 
## [137] &quot;Venezuela&quot;                &quot;Vietnam&quot;                 
## [139] &quot;West Bank and Gaza&quot;       &quot;Yemen Rep.&quot;              
## [141] &quot;Zambia&quot;                   &quot;Zimbabwe&quot;</code></pre>
<p>Okay, now we want to see just the rows of the data.frame where country is “United States”. The syntax for all <code>dplyr</code> functions is the same: The first argument is the data.frame, the rest of the arguments are whatever you want to do in that data.frame.</p>
<pre class="r"><code>filter(gapminder, country == &quot;United States&quot;)</code></pre>
<pre><code>## # A tibble: 12 x 6
##    country        year       pop continent lifeExp gdpPercap
##    &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 United States  1952 157553000 Americas     68.4    13990.
##  2 United States  1957 171984000 Americas     69.5    14847.
##  3 United States  1962 186538000 Americas     70.2    16173.
##  4 United States  1967 198712000 Americas     70.8    19530.
##  5 United States  1972 209896000 Americas     71.3    21806.
##  6 United States  1977 220239000 Americas     73.4    24073.
##  7 United States  1982 232187835 Americas     74.6    25010.
##  8 United States  1987 242803533 Americas     75.0    29884.
##  9 United States  1992 256894189 Americas     76.1    32004.
## 10 United States  1997 272911760 Americas     76.8    35767.
## 11 United States  2002 287675526 Americas     77.3    39097.
## 12 United States  2007 301139947 Americas     78.2    42952.</code></pre>
<p>We can also apply multiple conditions, e.g. the US after 2000:</p>
<pre class="r"><code>filter(gapminder, country == &quot;United States&quot; &amp; year &gt; 2000)</code></pre>
<pre><code>## # A tibble: 2 x 6
##   country        year       pop continent lifeExp gdpPercap
##   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1 United States  2002 287675526 Americas     77.3    39097.
## 2 United States  2007 301139947 Americas     78.2    42952.</code></pre>
<p>We can also use “or” conditions with the vertical pipe: <code>|</code>. Notice that the variable (column) names don’t go in quotes, but values of character variables do.</p>
<pre class="r"><code>filter(gapminder, country == &quot;United States&quot; | country == &quot;Mexico&quot;)</code></pre>
<pre><code>## # A tibble: 24 x 6
##    country  year      pop continent lifeExp gdpPercap
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 Mexico   1952 30144317 Americas     50.8     3478.
##  2 Mexico   1957 35015548 Americas     55.2     4132.
##  3 Mexico   1962 41121485 Americas     58.3     4582.
##  4 Mexico   1967 47995559 Americas     60.1     5755.
##  5 Mexico   1972 55984294 Americas     62.4     6809.
##  6 Mexico   1977 63759976 Americas     65.0     7675.
##  7 Mexico   1982 71640904 Americas     67.4     9611.
##  8 Mexico   1987 80122492 Americas     69.5     8688.
##  9 Mexico   1992 88111030 Americas     71.5     9472.
## 10 Mexico   1997 95895146 Americas     73.7     9767.
## # … with 14 more rows</code></pre>
<p>A good, handy reference list for the operators (and, or, etc) can be found <a href="http://www.statmethods.net/management/operators.html">here</a>.</p>
</div>
<div id="select" class="section level4">
<h4><code>select()</code></h4>
<p><code>filter</code> returned a subset of the data.frame’s rows. <code>select</code> returns a subset of the data.frame’s columns.</p>
<p>Suppose we only want to see country and life expectancy.</p>
<pre class="r"><code>select(gapminder, country, lifeExp)</code></pre>
<p>We can choose which columns we don’t want</p>
<pre class="r"><code>select(gapminder, -continent, income = gdpPercap)</code></pre>
<pre><code>## # A tibble: 1,704 x 5
##    country      year      pop lifeExp income
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 Afghanistan  1952  8425333    28.8   779.
##  2 Afghanistan  1957  9240934    30.3   821.
##  3 Afghanistan  1962 10267083    32.0   853.
##  4 Afghanistan  1967 11537966    34.0   836.
##  5 Afghanistan  1972 13079460    36.1   740.
##  6 Afghanistan  1977 14880372    38.4   786.
##  7 Afghanistan  1982 12881816    39.9   978.
##  8 Afghanistan  1987 13867957    40.8   852.
##  9 Afghanistan  1992 16317921    41.7   649.
## 10 Afghanistan  1997 22227415    41.8   635.
## # … with 1,694 more rows</code></pre>
<p>And we can rename columns</p>
<pre class="r"><code>select(gapminder, ThePlace = country, HowLongTheyLive = lifeExp)</code></pre>
<pre><code>## # A tibble: 1,704 x 2
##    ThePlace    HowLongTheyLive
##    &lt;chr&gt;                 &lt;dbl&gt;
##  1 Afghanistan            28.8
##  2 Afghanistan            30.3
##  3 Afghanistan            32.0
##  4 Afghanistan            34.0
##  5 Afghanistan            36.1
##  6 Afghanistan            38.4
##  7 Afghanistan            39.9
##  8 Afghanistan            40.8
##  9 Afghanistan            41.7
## 10 Afghanistan            41.8
## # … with 1,694 more rows</code></pre>
<p>As usual, R isn’t saving any of these outputs; just printing them to the screen. If we want to keep them around, we need to assign them to a variable.</p>
<pre class="r"><code>justUS = filter(gapminder, country == &quot;United States&quot;)
USdata = select(justUS, -country, -continent)
USdata</code></pre>
<pre><code>## # A tibble: 12 x 4
##     year       pop lifeExp gdpPercap
##    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1  1952 157553000    68.4    13990.
##  2  1957 171984000    69.5    14847.
##  3  1962 186538000    70.2    16173.
##  4  1967 198712000    70.8    19530.
##  5  1972 209896000    71.3    21806.
##  6  1977 220239000    73.4    24073.
##  7  1982 232187835    74.6    25010.
##  8  1987 242803533    75.0    29884.
##  9  1992 256894189    76.1    32004.
## 10  1997 272911760    76.8    35767.
## 11  2002 287675526    77.3    39097.
## 12  2007 301139947    78.2    42952.</code></pre>
<blockquote>
<h4 id="subsetting" class="challenge">Subsetting</h4>
<ul>
<li>Subset the gapminder data to only Oceania countries post-1980.</li>
<li>Remove the continent column</li>
<li>Make a scatter plot of gdpPercap vs. population colored by country</li>
</ul>
<p><strong>Advanced</strong> How would you determine the median population for the North American countries between 1970 and 1980?</p>
<p><strong>Bonus</strong> This can be done using base R’s subsetting, but this class doesn’t teach how. Do the original challenge without the <code>filter</code> and <code>select</code> functions. Feel free to consult Google, helpfiles, etc. to figure out how.</p>
</blockquote>
</div>
<div id="arrange" class="section level4">
<h4><code>arrange()</code></h4>
<p>You can order the rows of a data.frame by a variable using <code>arrange</code>. Suppose we want to see the most populous countries:</p>
<pre class="r"><code>arrange(gapminder, pop)</code></pre>
<pre><code>## # A tibble: 1,704 x 6
##    country                year   pop continent lifeExp gdpPercap
##    &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 Sao Tome and Principe  1952 60011 Africa       46.5      880.
##  2 Sao Tome and Principe  1957 61325 Africa       48.9      861.
##  3 Djibouti               1952 63149 Africa       34.8     2670.
##  4 Sao Tome and Principe  1962 65345 Africa       51.9     1072.
##  5 Sao Tome and Principe  1967 70787 Africa       54.4     1385.
##  6 Djibouti               1957 71851 Africa       37.3     2865.
##  7 Sao Tome and Principe  1972 76595 Africa       56.5     1533.
##  8 Sao Tome and Principe  1977 86796 Africa       58.6     1738.
##  9 Djibouti               1962 89898 Africa       39.7     3021.
## 10 Sao Tome and Principe  1982 98593 Africa       60.4     1890.
## # … with 1,694 more rows</code></pre>
<p>Hmm, we didn’t get the most populous countries. By default, <code>arrange</code> sorts the variable in <em>increasing</em> order. We could see the most populous countries by examining the <code>tail</code> of the last command, or we can sort the data.frame by descending population by wrapping the variable in <code>desc()</code>:</p>
<pre class="r"><code>arrange(gapminder, desc(pop))</code></pre>
<pre><code>## # A tibble: 1,704 x 6
##    country  year        pop continent lifeExp gdpPercap
##    &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 China    2007 1318683096 Asia         73.0     4959.
##  2 China    2002 1280400000 Asia         72.0     3119.
##  3 China    1997 1230075000 Asia         70.4     2289.
##  4 China    1992 1164970000 Asia         68.7     1656.
##  5 India    2007 1110396331 Asia         64.7     2452.
##  6 China    1987 1084035000 Asia         67.3     1379.
##  7 India    2002 1034172547 Asia         62.9     1747.
##  8 China    1982 1000281000 Asia         65.5      962.
##  9 India    1997  959000000 Asia         61.8     1459.
## 10 China    1977  943455000 Asia         64.0      741.
## # … with 1,694 more rows</code></pre>
<p><code>arrange</code> can also sort by multiple variables. It will sort the data.frame by the first variable, and if there are any ties in that variable, they will be sorted by the next variable, and so on. Here we sort from newest to oldest, and within year from richest to poorest:</p>
<pre class="r"><code>arrange(gapminder, desc(year), desc(gdpPercap))</code></pre>
<pre><code>## # A tibble: 1,704 x 6
##    country          year       pop continent lifeExp gdpPercap
##    &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 Norway           2007   4627926 Europe       80.2    49357.
##  2 Kuwait           2007   2505559 Asia         77.6    47307.
##  3 Singapore        2007   4553009 Asia         80.0    47143.
##  4 United States    2007 301139947 Americas     78.2    42952.
##  5 Ireland          2007   4109086 Europe       78.9    40676.
##  6 Hong Kong China  2007   6980412 Asia         82.2    39725.
##  7 Switzerland      2007   7554661 Europe       81.7    37506.
##  8 Netherlands      2007  16570613 Europe       79.8    36798.
##  9 Canada           2007  33390141 Americas     80.7    36319.
## 10 Iceland          2007    301931 Europe       81.8    36181.
## # … with 1,694 more rows</code></pre>
<p><strong>Shoutout Q: Would we get the same output if we switched the order of <code>desc(year)</code> and <code>desc(gdpPercap)</code> in the last line?</strong></p>
</div>
<div id="mutate" class="section level4">
<h4><code>mutate()</code></h4>
<p>We have learned how to drop rows, drop columns, and rearrange rows. To make a new column we use the <code>mutate</code> function. As usual, the first argument is a data.frame. The second argument is the name of the new column you want to create, followed by an equal sign, followed by what to put in that column. You can reference other variables in the data.frame, and <code>mutate</code> will treat each row independently. E.g. we can calculate the total GDP of each country in each year by multiplying the per-capita GDP by the population.</p>
<pre class="r"><code>mutate(gapminder, total_gdp = gdpPercap * pop)</code></pre>
<pre><code>## # A tibble: 1,704 x 7
##    country      year      pop continent lifeExp gdpPercap    total_gdp
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan  1952  8425333 Asia         28.8      779.  6567086330.
##  2 Afghanistan  1957  9240934 Asia         30.3      821.  7585448670.
##  3 Afghanistan  1962 10267083 Asia         32.0      853.  8758855797.
##  4 Afghanistan  1967 11537966 Asia         34.0      836.  9648014150.
##  5 Afghanistan  1972 13079460 Asia         36.1      740.  9678553274.
##  6 Afghanistan  1977 14880372 Asia         38.4      786. 11697659231.
##  7 Afghanistan  1982 12881816 Asia         39.9      978. 12598563401.
##  8 Afghanistan  1987 13867957 Asia         40.8      852. 11820990309.
##  9 Afghanistan  1992 16317921 Asia         41.7      649. 10595901589.
## 10 Afghanistan  1997 22227415 Asia         41.8      635. 14121995875.
## # … with 1,694 more rows</code></pre>
<p><strong>Shoutout Q: How would we view the highest-total-gdp countries?</strong></p>
<p>Note that didn’t change gapminder: We didn’t assign the output to anything, so it was just printed, with the new column. If we want to modify our gapminder data.frame, we can assign the output of <code>mutate</code> back to the gapminder variable, but be careful doing this – if you make a mistake, you can’t just re-run that line of code, you’ll need to go back to loading the gapminder data.frame.</p>
<p>Also, you can create multiple columns in one call to <code>mutate</code>, even using variables that you just created, separating them with commas:</p>
<pre class="r"><code>gapminder = mutate(gapminder, 
                   total_gdp = gdpPercap * pop,
                   log_gdp = log10(total_gdp))</code></pre>
<blockquote>
<h4 id="mcq-data-reduction" class="challenge">MCQ: Data Reduction</h4>
<p>Produce a data.frame with only the names, years, and per-capita GDP of countries where per capita gdp is less than a dollar a day sorted from most- to least-recent.</p>
<ul>
<li>Tip: The <code>gdpPercap</code> variable is annual gdp. You’ll need to adjust.</li>
<li>Tip: For complex tasks, it often helps to use pencil and paper to write/draw/map the various steps needed and how they fit together before writing any code.</li>
</ul>
<p>What is the annual per-capita gdp, rounded to the nearest dollar, of the first row in the data.frame?</p>
<ol style="list-style-type: lower-alpha">
<li>$278</li>
<li>$312</li>
<li>$331</li>
<li>$339</li>
</ol>
<p><strong>Advanced</strong>: Use dplyr functions and ggplot to plot per-capita GDP versus population for North American countries after 1970. - Once you’ve made the graph, transform both axes to a log10 scale. There are two ways to do this, one by creating new columns in the data frame, and another using functions provided by ggplot to transform the axes. Implement both, in that order. Which do you prefer and why?</p>
</blockquote>
</div>
<div id="cest-ne-pas-une-pipe" class="section level4">
<h4>C’est ne pas une pipe</h4>
<p>Suppose we want to look at all the countries where life expectancy is greater than 80 years, sorted from poorest to richest. First, we <code>filter</code>, then we <code>arrange</code>. We could assign the intermediate data.frame to a variable:</p>
<pre class="r"><code>lifeExpGreater80 = filter(gapminder, lifeExp &gt; 80)
(lifeExpGreater80sorted = arrange(lifeExpGreater80, gdpPercap))</code></pre>
<pre><code>## # A tibble: 21 x 8
##    country       year     pop continent lifeExp gdpPercap total_gdp log_gdp
##    &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 New Zealand   2007  4.12e6 Oceania      80.2    25185.   1.04e11    11.0
##  2 Israel        2007  6.43e6 Asia         80.7    25523.   1.64e11    11.2
##  3 Italy         2002  5.79e7 Europe       80.2    27968.   1.62e12    12.2
##  4 Italy         2007  5.81e7 Europe       80.5    28570.   1.66e12    12.2
##  5 Japan         2002  1.27e8 Asia         82      28605.   3.63e12    12.6
##  6 Japan         1997  1.26e8 Asia         80.7    28817.   3.63e12    12.6
##  7 Spain         2007  4.04e7 Europe       80.9    28821.   1.17e12    12.1
##  8 Sweden        2002  8.95e6 Europe       80.0    29342.   2.63e11    11.4
##  9 Hong Kong C…  2002  6.76e6 Asia         81.5    30209.   2.04e11    11.3
## 10 France        2007  6.11e7 Europe       80.7    30470.   1.86e12    12.3
## # … with 11 more rows</code></pre>
<p>In this case it doesn’t much matter, but we make a whole new data.frame (<code>lifeExpGreater80</code>) and only use it once; that’s a little wasteful of system resources, and it clutters our environment. If the data are large, that can be a big problem.</p>
<p>Or, we could nest each function so that it appears on one line:</p>
<pre class="r"><code>arrange(filter(gapminder, lifeExp &gt; 80), gdpPercap)</code></pre>
<pre><code>## # A tibble: 21 x 8
##    country       year     pop continent lifeExp gdpPercap total_gdp log_gdp
##    &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 New Zealand   2007  4.12e6 Oceania      80.2    25185.   1.04e11    11.0
##  2 Israel        2007  6.43e6 Asia         80.7    25523.   1.64e11    11.2
##  3 Italy         2002  5.79e7 Europe       80.2    27968.   1.62e12    12.2
##  4 Italy         2007  5.81e7 Europe       80.5    28570.   1.66e12    12.2
##  5 Japan         2002  1.27e8 Asia         82      28605.   3.63e12    12.6
##  6 Japan         1997  1.26e8 Asia         80.7    28817.   3.63e12    12.6
##  7 Spain         2007  4.04e7 Europe       80.9    28821.   1.17e12    12.1
##  8 Sweden        2002  8.95e6 Europe       80.0    29342.   2.63e11    11.4
##  9 Hong Kong C…  2002  6.76e6 Asia         81.5    30209.   2.04e11    11.3
## 10 France        2007  6.11e7 Europe       80.7    30470.   1.86e12    12.3
## # … with 11 more rows</code></pre>
<p>This would become difficult to read if we are performing a number of operations that would require a repeated nesting. But…</p>
<p>There is a better way, and it makes both writing and reading the code easier. The pipe from the <code>magrittr</code> package (which is automatically installed and loaded with <code>dplyr</code> and <code>tidyverse</code>) takes the output of first line, and plugs it in as the first argument of the next line. Since many <code>tidyverse</code> functions expect a data.frame as the first argument and output a data.frame, this works fluidly.</p>
<pre class="r"><code>filter(gapminder, lifeExp &gt; 80) %&gt;%
    arrange(gdpPercap)</code></pre>
<pre><code>## # A tibble: 21 x 8
##    country       year     pop continent lifeExp gdpPercap total_gdp log_gdp
##    &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 New Zealand   2007  4.12e6 Oceania      80.2    25185.   1.04e11    11.0
##  2 Israel        2007  6.43e6 Asia         80.7    25523.   1.64e11    11.2
##  3 Italy         2002  5.79e7 Europe       80.2    27968.   1.62e12    12.2
##  4 Italy         2007  5.81e7 Europe       80.5    28570.   1.66e12    12.2
##  5 Japan         2002  1.27e8 Asia         82      28605.   3.63e12    12.6
##  6 Japan         1997  1.26e8 Asia         80.7    28817.   3.63e12    12.6
##  7 Spain         2007  4.04e7 Europe       80.9    28821.   1.17e12    12.1
##  8 Sweden        2002  8.95e6 Europe       80.0    29342.   2.63e11    11.4
##  9 Hong Kong C…  2002  6.76e6 Asia         81.5    30209.   2.04e11    11.3
## 10 France        2007  6.11e7 Europe       80.7    30470.   1.86e12    12.3
## # … with 11 more rows</code></pre>
<p>To demonstrate how it works, here are some examples where it’s unnecessary.</p>
<pre class="r"><code>4 %&gt;% sqrt()</code></pre>
<pre><code>## [1] 2</code></pre>
<pre class="r"><code>2 ^ 2 %&gt;% sum(1)</code></pre>
<pre><code>## [1] 5</code></pre>
<p>Whatever goes through the pipe becomes the first argument of the function after the pipe. This is convenient, because all <code>dplyr</code> functions produce a data.frame as their output and take a data.frame as the first argument. Since R ignores white-space, we can put each function on a new line, which RStudio will automatically indent, making everything easy to read. Now each line represents a step in a sequential operation. You can read this as “Take the gapminder data.frame, filter to the rows where lifeExp is greater than 80, and arrange by gdpPercap.”</p>
<pre class="r"><code>gapminder %&gt;%
    filter(lifeExp &gt; 80) %&gt;%
    arrange(gdpPercap)</code></pre>
<pre><code>## # A tibble: 21 x 8
##    country       year     pop continent lifeExp gdpPercap total_gdp log_gdp
##    &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 New Zealand   2007  4.12e6 Oceania      80.2    25185.   1.04e11    11.0
##  2 Israel        2007  6.43e6 Asia         80.7    25523.   1.64e11    11.2
##  3 Italy         2002  5.79e7 Europe       80.2    27968.   1.62e12    12.2
##  4 Italy         2007  5.81e7 Europe       80.5    28570.   1.66e12    12.2
##  5 Japan         2002  1.27e8 Asia         82      28605.   3.63e12    12.6
##  6 Japan         1997  1.26e8 Asia         80.7    28817.   3.63e12    12.6
##  7 Spain         2007  4.04e7 Europe       80.9    28821.   1.17e12    12.1
##  8 Sweden        2002  8.95e6 Europe       80.0    29342.   2.63e11    11.4
##  9 Hong Kong C…  2002  6.76e6 Asia         81.5    30209.   2.04e11    11.3
## 10 France        2007  6.11e7 Europe       80.7    30470.   1.86e12    12.3
## # … with 11 more rows</code></pre>
<p>Making your code easier for humans to read will save you lots of time. The human reading it is usually future-you, and operations that seem simple when you’re writing them will look like gibberish when you’re three weeks removed from them, let alone three months or three years or another person. Make your code as easy to read as possible by using the pipe where appropriate, leaving white space, using descriptive variable names, being consistent with spacing and naming, and liberally commenting code.</p>
<blockquote>
<h4 id="challenge-data-reduction-with-pipes" class="challenge">Challenge: Data Reduction with Pipes</h4>
<p>Copy the code you (or the instructor) wrote to solve the previous MCQ Data Reduction challenge. Rewrite it using pipes (i.e. no assignment and no nested functions)</p>
</blockquote>
</div>
<div id="summarize" class="section level4">
<h4><code>summarize()</code></h4>
<p>Often we want to calculate a new variable, but rather than keeping each row as an independent observation, we want to group observations together to calculate some summary statistic. To do this we need two functions, one to do the grouping and one to calculate the summary statistic: <code>group_by</code> and <code>summarize</code>. By itself <code>group_by</code> doesn’t change a data.frame; it just sets up the grouping. <code>summarize</code> then goes over each group in the data.frame and does whatever calculation you want. E.g. suppose we want the average global gdp for each year. While we’re at it, let’s calculate the mean and median and see how they differ.</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(year) %&gt;%
    summarize(mean_gdp = mean(gdpPercap), median_gdp = median(gdpPercap))</code></pre>
<pre><code>## # A tibble: 12 x 3
##     year mean_gdp median_gdp
##    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1  1952    3725.      1969.
##  2  1957    4299.      2173.
##  3  1962    4726.      2335.
##  4  1967    5484.      2678.
##  5  1972    6770.      3339.
##  6  1977    7313.      3799.
##  7  1982    7519.      4216.
##  8  1987    7901.      4280.
##  9  1992    8159.      4386.
## 10  1997    9090.      4782.
## 11  2002    9918.      5320.
## 12  2007   11680.      6124.</code></pre>
<p><strong>Shoutout Q: Note that <code>summarize</code> eliminates any other columns. Why? What else can it do? E.g. What country should it list for the year 1952!?</strong></p>
<p>There are several different summary statistics that can be generated from our data. The R base package provides many built-in functions such as <code>mean</code>, <code>median</code>, <code>min</code>, <code>max</code>, and <code>range</code>. By default, all <strong>R functions operating on vectors that contains missing data will return NA</strong>. It’s a way to make sure that users know they have missing data, and make a conscious decision on how to deal with it. When dealing with simple statistics like the mean, the easiest way to ignore <code>NA</code> (the missing data) is to use <code>na.rm=TRUE</code> (<code>rm</code> stands for remove). An alternate option is to use the function <code>is.na()</code>, which evaluates to true if the value passed to it is not a number. This function is more useful as a part of a filter, where you can filter out everything that is not a number. For that purpose you would do something like</p>
<pre class="r"><code>gapminder %&gt;%
  filter(!is.na(someColumn)) </code></pre>
<p>The <code>!</code> symbol negates it, so we’re asking for everything that is not an <code>NA</code>.</p>
<p>We often want to calculate the number of entries within a group. E.g. we might wonder if our dataset is balanced by country. We can do this with the <code>n()</code> function, or <code>dplyr</code> provides a <code>count</code> function as a convenience:</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(country) %&gt;%
    summarize(number_entries = n())</code></pre>
<pre><code>## # A tibble: 142 x 2
##    country     number_entries
##    &lt;chr&gt;                &lt;int&gt;
##  1 Afghanistan             12
##  2 Albania                 12
##  3 Algeria                 12
##  4 Angola                  12
##  5 Argentina               12
##  6 Australia               12
##  7 Austria                 12
##  8 Bahrain                 12
##  9 Bangladesh              12
## 10 Belgium                 12
## # … with 132 more rows</code></pre>
<pre class="r"><code>count(gapminder, country)</code></pre>
<pre><code>## # A tibble: 142 x 2
##    country         n
##    &lt;chr&gt;       &lt;int&gt;
##  1 Afghanistan    12
##  2 Albania        12
##  3 Algeria        12
##  4 Angola         12
##  5 Argentina      12
##  6 Australia      12
##  7 Austria        12
##  8 Bahrain        12
##  9 Bangladesh     12
## 10 Belgium        12
## # … with 132 more rows</code></pre>
<p>We can also do multiple groupings. Suppose we want the maximum life expectancy in each continent for each year. We group by continent and year and calculate the maximum with the <code>max</code> function:</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(continent, year) %&gt;%
    summarize(longest_life = max(lifeExp))</code></pre>
<pre><code>## # A tibble: 60 x 3
## # Groups:   continent [5]
##    continent  year longest_life
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Africa     1952         52.7
##  2 Africa     1957         58.1
##  3 Africa     1962         60.2
##  4 Africa     1967         61.6
##  5 Africa     1972         64.3
##  6 Africa     1977         67.1
##  7 Africa     1982         69.9
##  8 Africa     1987         71.9
##  9 Africa     1992         73.6
## 10 Africa     1997         74.8
## # … with 50 more rows</code></pre>
<p>Hmm, we got the longest life expectancy for each continent-year, but we didn’t get the country. To get the country, we have to ask R “Where lifeExp is at a maximum, what is the entry in country?” For that we use the <code>which.max</code> function. <code>max</code> returns the maximum value; <code>which.max</code> returns the location of the maximum value.</p>
<pre class="r"><code>max(c(1, 7, 4))</code></pre>
<pre><code>## [1] 7</code></pre>
<pre class="r"><code>which.max(c(1, 7, 4))</code></pre>
<pre><code>## [1] 2</code></pre>
<p>Now, back to the question: Where lifeExp is at a maximum, what is the entry in country?</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(continent, year) %&gt;%
    summarize(longest_life = max(lifeExp), country = country[which.max(lifeExp)])</code></pre>
<pre><code>## # A tibble: 60 x 4
## # Groups:   continent [5]
##    continent  year longest_life country  
##    &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;    
##  1 Africa     1952         52.7 Reunion  
##  2 Africa     1957         58.1 Mauritius
##  3 Africa     1962         60.2 Mauritius
##  4 Africa     1967         61.6 Mauritius
##  5 Africa     1972         64.3 Reunion  
##  6 Africa     1977         67.1 Reunion  
##  7 Africa     1982         69.9 Reunion  
##  8 Africa     1987         71.9 Reunion  
##  9 Africa     1992         73.6 Reunion  
## 10 Africa     1997         74.8 Reunion  
## # … with 50 more rows</code></pre>
<blockquote>
<h4 id="challenge-part-1" class="challenge">Challenge – Part 1</h4>
<ul>
<li>Calculate a new column: the total GDP of each country in each year.</li>
<li>Calculate the variance – <code>var()</code> of countries’ gdps in each year.</li>
<li>Is country-level GDP getting more or less equal over time?</li>
</ul>
</blockquote>
<blockquote>
<h4 id="challenge-part-2" class="challenge">Challenge – Part 2</h4>
<ul>
<li>Modify the code you just wrote to calculate the variance in both country-level GDP and per-capita GDP.</li>
<li>Do both measures support the conclusion you arrived at above?</li>
</ul>
</blockquote>
</div>
<div id="resources" class="section level4">
<h4>Resources</h4>
<p>That is the core of <code>dplyr</code>’s functionality, but it does more. RStudio makes a great <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a> that covers all the <code>dplyr</code> functions we just learned, plus what we will learn in the next lesson: keeping data tidy.</p>
</div>
</div>
</div>
<div id="challenge-solutions" class="section level2">
<h2>Challenge solutions</h2>
<p><span style="color:white"><strong>Solution to challenge Subsetting</strong></span></p>
<p><span style="color:white"> - Subset the gapminder data to only Oceania countries post-1980.<br />
- Remove the continent column<br />
- Make a scatter plot of gdpPercap vs. population colored by country</span></p>
<p><span style="color:white"><code>library(gapminder)</code></span> <span style="color:white"> <code>oc1980 = filter(gapminder, continent == "Oceania" &amp; year &gt; 1980)</code> <code>oc1980less = select(oc1980, -continent)</code> <code>library('ggplot2')</code> <code>ggplot(oc1980less, aes(x = gdpPercap, y = lifeExp, color = country)) +</code> <code>geom_point()</code> </span></p>
<p><span style="color:white"><strong>Advanced:</strong> How would you determine the median population for the North American countries between 1970 and 1980?</span></p>
<p><span style="color:white"> <code>library(gapminder)</code> <code>library(tidyverse)</code> <code>noAm = filter(gapminder, country == "United States" | country == "Canada" |</code> <code>country == "Mexico" | country == "Puerto Rico" &amp; (year &gt; 1970 &amp; year &lt; 1980))</code> <code>noAmPop = select(noAm, pop)</code> <code>#median(noAmPop)</code> <code>#noAmPop</code> <code>#as.integer(noAmPop)</code> <code>median(unlist(noAmPop))</code> </span></p>
<p><span style="color:white"><strong>Bonus</strong> This can be done using base R’s subsetting, but this class doesn’t teach how. Do the original challenge without the <code>filter</code> and <code>select</code> functions. Feel free to consult Google, helpfiles, etc. to figure out how. </span></p>
<p><span style="color:white"> <code>noAm2 = gapminder[(gapminder$country == "United States") |</code> <code>(gapminder$country == "Mexico") |</code> <code>(gapminder$country == "Canada") |</code> <code>(gapminder$country == "Puerto Rico") &amp;</code> <code>((gapminder$year &gt; 1970) &amp;</code> <code>(gapminder$year &lt; 1980)),]</code> <code>median(noAm2$pop)</code> </span></p>
<p><span style="color:white"><strong>Solution to challenge MCQ: Data Reduction</strong></span></p>
<p><span style="color:white">Produce a data.frame with only the names, years, and per-capita GDP of countries where per capita gdp is less than a dollar a day sorted from most- to least-recent.</span></p>
<p><span style="color:white"> - Tip: The <code>gdpPercap</code> variable is annual gdp. You’ll need to adjust. - Tip: For complex tasks, it often helps to use pencil and paper to write/draw/map the various steps needed and how they fit together before writing any code.</p>
<p><span style="color:white">What is the annual per-capita gdp, rounded to the nearest dollar, of the first row in the data.frame?</span></p>
<p><span style="color:white"> a. $278 b. $312 c. $331 d. $339 </span></p>
<p><span style="color:white"> <code>dailyGDP = mutate(gapminder, onedayGDP = gdpPercap / 365)</code> <code>dailyGDP = filter(dailyGDP, onedayGDP &lt; 1)</code> <code>dailyGDP = select(dailyGDP, country, year, gdpPercap)</code> <code>dailyGDP[1,]</code> </span></p>
<p><span style="color:white"> <strong>Advanced</strong>: Use dplyr functions and ggplot to plot per-capita GDP versus population for North American countries after 1970. - Once you’ve made the graph, transform both axes to a log10 scale. There are two ways to do this, one by creating new columns in the data frame, and another using functions provided by ggplot to transform the axes. Implement both, in that order. Which do you prefer and why? </span></p>
<p><span style="color:white"> <code>noAm = filter(gapminder, country == "United States" |</code> <code>country == "Canada" | country == "Mexico" |</code> <code>country == "Puerto Rico" &amp; year &gt; 1970</code> <code>)</code> <code>ggplot(noAm, aes(x = gdpPercap, y = pop, color = country)) +</code> <code>geom_point() +</code> <code>scale_x_log10() +</code> <code>scale_y_log10()</code> </span></p>
<p><span style="color:white"><strong>Challenge: Data Reduction with Pipes</strong></span></p>
<p><span style="color:white">Copy the code you (or the instructor) wrote to solve the previous MCQ Data Reduction challenge. Rewrite it using pipes (i.e. no assignment and no nested functions)</span></p>
<p><span style="color:white"> Previous challenge with pipes <code>dailyGDP = mutate(gapminder, onedayGDP = gdpPercap / 365)</code> <code>dailyGDP = filter(dailyGDP, onedayGDP &lt; 1)</code> <code>dailyGDP = select(dailyGDP, country, year, gdpPercap)</code> <code>smallGDP = gapminder %&gt;%</code> <code>mutate(onedayGDP = gdpPercap / 365) %&gt;%</code> <code>filter(onedayGDP &lt; 1) %&gt;%</code> <code>select(country, year, gdpPercap)</code> <code>smallGDP[1,]</code> </span></p>
<p><span style="color:white"> <strong>OR, more fancy</strong> (without an intermediate temp variable) <code></code>(gapminder %&gt;% <code></code> mutate(onedayGDP = gdpPercap / 365) %&gt;% <code></code> filter(onedayGDP &lt; 1) %&gt;% <code></code> select(country, year, gdpPercap))[1,] ` </span></p>
<p>This lesson is adapted from the Software Carpentry: R for Reproducible Scientific Analysis <a href="http://data-lessons.github.io/gapminder-R/03-data-types-subsetting.html">Vectors and Data Frames materials</a>, the Software Carpentry: R for Reproducible Scientific Analysis <a href="http://data-lessons.github.io/gapminder-R/05-dplyr-single-table.html">Manipulating Data.Frames materials</a>, and the Software Carpentry: R for Reproducbile Scientific Analysis <a href="http://data-lessons.github.io/gapminder-R/04-ggplot.html">Plotting materials</a>.</p>
<p>Find the latest version of Software Carpentry: R for Reproducible Scientific Analysis <a href="http://swcarpentry.github.io/r-novice-gapminder/">here</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
